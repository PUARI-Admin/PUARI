<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8" />
<title>ピンポン漢字</title>
<link rel="stylesheet" th:href="@{/css/kanji.css}" type="text/css">
<link rel="stylesheet" th:href="@{/css/common.css}" type="text/css">

<script type="text/javascript">

document.onkeydown = function(e) {

	var keyCode = false;
	if (e) event = e;
	if (event) {
		if (event.keyCode) {
			keyCode = event.keyCode;

	        if(keyCode == 37) {
	    		next_action();
	        } else if (keyCode == 38) {
	          	OK();
	        } else if (keyCode == 39) {
	           	NG();
	        }

	    } else if (event.which) {
	    	keyCode = event.which;
	    }
	}
};

function next_action() {

	var grade = document.getElementsByName("hidden_grade")[0].value
	var action_path = "/kanji/" + grade
	document.next_form.action=action_path;
	document.next_form.method="post";
	document.next_form.submit();
}

function seiseki() {

	var grade = document.getElementsByName("hidden_grade")[0].value
	var action_path = "/kanji/seiseki/" + grade
	document.next_form.action=action_path;
	document.next_form.method="post";
	document.next_form.submit();
}

var total_count = 0;
var audioElem;
var yomi_ok_count = 0;
var yomi_ng_count = 0;

function OK() {

	audioElem = new Audio();
	audioElem.src = "/audio/seikai.mp3";
	audioElem.play();

	total_count = [[${kanji.getTotalCount()}]] + 1;
	yomi_ok_count = [[${kanji.getYomi_ok()}]];
	yomi_ng_count = [[${kanji.getYomi_ng()}]];
	yomi_ok_count = yomi_ok_count + 1;
	yomi_ng_count = yomi_ng_count;

	document.getElementById("ok_button").disabled = true;
	document.getElementById("ng_button").disabled = true;
	document.getElementById("gazou").src = "/image/maru.png";
	document.getElementById("total_count").textContent = total_count;
	document.getElementsByName("hidden_total_count")[0].value = total_count;

	setAnswer();
}

function NG(){
	audioElem = new Audio();
	audioElem.src = "/audio/spring.mp3";
	audioElem.play();

	yomi_ok_count = [[${kanji.getYomi_ok()}]];
	yomi_ng_count = [[${kanji.getYomi_ng()}]];
	yomi_ok_count = yomi_ok_count;
	yomi_ng_count = yomi_ng_count + 1;

	document.getElementById("ok_button").disabled = true;
	document.getElementById("ng_button").disabled = true;
	document.getElementById("gazou").src = "/image/batsu.png";

	setAnswer();
}

function setAnswer() {

	document.getElementById("onyomi1").innerHTML = document.getElementsByName("hidden_onyomi1")[0].value;
	document.getElementById("onyomi1").textContent = document.getElementsByName("hidden_onyomi1")[0].value;
	document.getElementById("onyomi2").textContent = document.getElementsByName("hidden_onyomi2")[0].value;
	document.getElementById("onyomi3").textContent = document.getElementsByName("hidden_onyomi3")[0].value;
	document.getElementById("onyomi4").textContent = document.getElementsByName("hidden_onyomi4")[0].value;
	document.getElementById("kunyomi1").textContent = document.getElementsByName("hidden_kunyomi1")[0].value;
	document.getElementById("kunyomi2").textContent = document.getElementsByName("hidden_kunyomi2")[0].value;
	document.getElementById("kunyomi3").textContent = document.getElementsByName("hidden_kunyomi3")[0].value;
	document.getElementById("kunyomi4").textContent = document.getElementsByName("hidden_kunyomi4")[0].value;
	document.getElementById("ok_history").textContent = yomi_ok_count;
	document.getElementsByName("hidden_ok_count")[0].value = yomi_ok_count;
	document.getElementById("ng_history").textContent = yomi_ng_count;
	document.getElementsByName("hidden_ng_count")[0].value = yomi_ng_count;
}

</script>
</head>

<body>
	<header class="header">
		<div class="header-left">
			<span class="header-label"> <label>[[${kanji.getGrade_Jap()}]]</label>
			</span>
		</div>
		<div class="header-center">
			<span class="header-label"> <label>正解</label> <label
				id="ok_history">[[${kanji.getYomi_ok()}]]</label> <label>回
					不正解 </label> <label id="ng_history">[[${kanji.getYomi_ng()}]]</label> <label>回</label>
			</span>
		</div>
		<div class="header-right">
			<label class="count-label" id="total_count">[[${kanji.getTotalCount()}]]</label>
		</div>
	</header>

	<main>
		<div class="center-left">
			<label class="kanji_label">[[${kanji.getKanji()}]]</label> <img
				class="image" id="gazou" th:src="@{/image/toumei.png}" width="500"
				height="500">
		</div>

		<div class="center-right">
			<ul class="ul_right">
				<li><label class="onyomi_label" th:if="${kanji.getOnyomi1()}">音読み</label></li>
				<li><label class="answer_label" th:if="${kanji.getOnyomi1()}">1:
				</label> <label class="answer_label" id="onyomi1"></label></li>
				<li><label class="answer_label" th:if="${kanji.getOnyomi2()}">2:
				</label> <label class="answer_label" id="onyomi2"></label></li>
				<li><label class="answer_label" th:if="${kanji.getOnyomi3()}">3:
				</label> <label class="answer_label" id="onyomi3"></label></li>
				<li><label class="answer_label" th:if="${kanji.getOnyomi4()}">4:
				</label> <label class="answer_label" id="onyomi4"></label></li>
				<li><label class="kunyomi_label" th:if="${kanji.getKunyomi1()}">訓読み</label></li>
				<li><label class="answer_label" th:if="${kanji.getKunyomi1()}">1:
				</label> <label class="answer_label" id="kunyomi1"></label></li>
				<li><label class="answer_label" th:if="${kanji.getKunyomi2()}">2:
				</label> <label class="answer_label" id="kunyomi2"></label></li>
				<li><label class="answer_label" th:if="${kanji.getKunyomi3()}">3:
				</label> <label class="answer_label" id="kunyomi3"></label></li>
				<li><label class="answer_label" th:if="${kanji.getKunyomi4()}">4:
				</label> <label class="answer_label" id="kunyomi4"></label></li>
			</ul>
		</div>
	</main>

	<footer class="footer">
		<div class="footer-left">
			<button class="modoru" onclick="location.href='/kanji'" name="modoru">戻る</button>
			<button class="seiseki" onclick="seiseki();" name="seiseki">成績</button>
		</div>

		<div class="footer-center">
			<form method="post" name="next_form" enctype="multipart/form-data"
				th:object="${sendForm}">
				<input type="hidden" name="hidden_id" th:value="${kanji.getId()}">
				<input type="hidden" name="hidden_onyomi1"
					th:value="${kanji.getOnyomi1()}"> <input type="hidden"
					name="hidden_onyomi2" th:value="${kanji.getOnyomi2()}"> <input
					type="hidden" name="hidden_onyomi3"
					th:value="${kanji.getOnyomi3()}"> <input type="hidden"
					name="hidden_onyomi4" th:value="${kanji.getOnyomi4()}"> <input
					type="hidden" name="hidden_kunyomi1"
					th:value="${kanji.getKunyomi1()}"> <input type="hidden"
					name="hidden_kunyomi2" th:value="${kanji.getKunyomi2()}"> <input
					type="hidden" name="hidden_kunyomi3"
					th:value="${kanji.getKunyomi3()}"> <input type="hidden"
					name="hidden_kunyomi4" th:value="${kanji.getKunyomi4()}"> <input
					type="hidden" name="hidden_ok_count"
					th:value="${kanji.getYomi_ok()}"> <input type="hidden"
					name="hidden_ng_count" th:value="${kanji.getYomi_ng()}"> <input
					type="hidden" name="hidden_total_count" th:value="${kanji.getTotalCount()}">
				<input type="hidden" name="hidden_grade"
					th:value="${kanji.getGrade()}">
				<button type="submit" onclick="next_action();" name="next">次へ</button>
			</form>
		</div>

		<div class="footer-right">
			<button type="submit" id="ok_button" onclick="OK();" name="ok">○</button>
			<button type="submit" id="ng_button" onclick="NG();" name="ng">×</button>
		</div>
	</footer>
</body>
</html>

